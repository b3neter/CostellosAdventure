<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Costellos Adventure</title>

    <style>
        #indexCanvas{
            margin:0; padding:0; 
            position:absolute; 
            top:0; left:0;
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            border: "red 1px solid";
        }
    </style>

</head>

<body>

    <canvas id="indexCanvas"></canvas>
    <audio autoplay loop>
        <source src="./assets/audio/music/a01_titletheme.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script>

        //Basierend auf
        //https://www.quora.com/JavaScript-Can-I-put-a-button-inside-a-canvas
        //Demo aus der Vorlesung
        var indexCanvas = document.getElementById('indexCanvas');
        var ctx = indexCanvas.getContext("2d");
        var bg;
        var bird;
        var startbutton;
        var levelbutton;
        var creditsbutton;
        var manualsbutton;
        var glWidth = window.innerWidth;
        var glHeight = window.innerHeight;
        indexCanvas.width = glWidth;
        indexCanvas.height = glHeight;
        var canvasPos = getPosition(canvas);
        var mouseX = 0;
        var mouseY = 0;

        class Button {
            constructor(image, x, y, width, height) {
                this.image = image;
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
            }
            draw() {
                ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
            }
            x() {
                return this.x
            }
            y() {
                return this.y
            }
            

        }



        preloadAssets();
        // Preload
        function preloadAssets() {
            var _toPreload = 0;

            var addImage = function (src) {

                var img = new Image();
                img.src = src;
                _toPreload++;

                img.addEventListener('load', function () {
                    _toPreload--;
                }, false);
                return img;
            }
            bg = addImage("assets/images/mainmenu/bg-menu.png");
            bird = addImage("assets/images/default/costelloball.png");
            startbutton = addImage("assets/images/mainmenu/startbutton.png");
            levelbutton = addImage("assets/images/mainmenu/levelbutton.png");
            creditsbutton = addImage("assets/images/mainmenu/creditsbutton.png");
            manualbutton = addImage("assets/images/mainmenu/manualbutton.png");


            var checkResources = function () {
                if (_toPreload == 0)
                    draw(); //6
                else
                    setTimeout(checkResources, 200);
            }
            checkResources();
        }

        // Get Position https://www.kirupa.com/canvas/follow_mouse_cursor.htm
        function getPosition(el) {
            var xPosition = 0;
            var yPosition = 0;

            while (el) {
                xPosition += (el.offsetLeft - el.scrollLeft + el.clientLeft);
                yPosition += (el.offsetTop - el.scrollTop + el.clientTop);
                el = el.offsetParent;
            }
            return {
                x: xPosition,
                y: yPosition
            };
        }


        // Get canvas element and its context
        var canvas = document.getElementById('indexCanvas')
        var ctx = canvas.getContext('2d');




        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            drawButtons();
            drawbird();
            requestAnimationFrame(draw);
        }

        function drawButtons() {

            var buttonheight = 0;
            var buttonwidth = 0;
            var starty  = glHeight/10;
            // min size
            if (glWidth > 959) {
                buttonheight = 64 ;
                buttonwidth = 128; 
            }
            else { buttonheight = 32;
                    buttonwidth = 64;}



            //                           image           x             y                         width        height
            start =     new Button(startbutton,     glWidth / 3, starty,                    buttonwidth, buttonheight);
            level =     new Button(levelbutton,     glWidth / 3, starty+buttonheight*1.5,   buttonwidth, buttonheight);
            manual =    new Button(manualbutton,    glWidth / 3, starty+buttonheight*3,     buttonwidth, buttonheight);
            credits =   new Button(creditsbutton,   glWidth / 3, starty+buttonheight*4.5,   buttonwidth, buttonheight);
            

            start.draw();
            level.draw();
            manual.draw();
            credits.draw();
            


        }


        function drawBackground() {
            ctx.drawImage(bg, 0, 0, glWidth, glHeight);
        }

        function drawbird() {
            ctx.drawImage(bird, mouseX - 30, mouseY - 30, 30, 30);
        }



        // Draw

        draw();


        //resize
        function onResize(event) {
            glWidth = window.innerWidth;
            glHeight = window.innerHeight;
            indexCanvas.width = glWidth;
            indexCanvas.height = glHeight;

        }
        // Add event listener to canvas element
        canvas.addEventListener("mousemove", function (event) {
            mouseX = event.clientX - canvasPos.x;
            mouseY = event.clientY - canvasPos.y;
        });
        window.addEventListener('resize', function (event) { onResize(event) }, false);
        canvas.addEventListener('click', function (event) {
            // Control that click event occurred within position of button
            // NOTE: This assumes canvas is positioned at top left corner 

            if (  //Start
                event.x > start.x &&
                event.x < start.x + start.width &&
                event.y > start.y &&
                event.y < start.y + start.height
            ) {
                window.open("./gamelogic/game.html?world=1&level=1", "_self");

            };
            if ( //Levelselect
                event.x > level.x &&
                event.x < level.x + level.width &&
                event.y > level.y &&
                event.y < level.y + level.height
            ) {
                window.open("./levelselect.html", "_self");
            };
            if ( //Manuals
                event.x > manual.x &&
                event.x < manual.x + manual.width &&
                event.y > manual.y &&
                event.y < manual.y + manual.height
            ) {
                window.open("./manual.html", "_self");
            };
            if ( //Credits
                event.x > credits.x &&
                event.x < credits.x + credits.width &&
                event.y > credits.y &&
                event.y < credits.y + credits.height
            ) {
                window.open("./credits.html", "_self");
            };
        });

    </script>
</body>

</html>
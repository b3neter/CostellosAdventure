<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Costellos Adventure</title>

    <style>
        #indexCanvas{
            margin:0; padding:0; 
            position:absolute; 
            top:0; left:0;
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            border: "red 1px solid";
        }
    </style>

</head>

<body>

    <canvas id="indexCanvas"></canvas>
    <audio autoplay loop>
        <source src="./assets/audio/music/a01_titletheme.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script>

        //Basierend auf
        //https://www.quora.com/JavaScript-Can-I-put-a-button-inside-a-canvas
        //Demo aus der Vorlesung
        var indexCanvas = document.getElementById('indexCanvas');
        var ctx = indexCanvas.getContext("2d");
        var bg;
        var bird;
        var startbutton;
        var levelbutton;
        var creditsbutton;
        var manualsbutton;
        var glWidth = window.innerWidth;
        var glHeight = window.innerHeight;
        indexCanvas.width = glWidth;
        indexCanvas.height = glHeight;
        var canvasPos = getPosition(canvas);
        var mouseX = 0;
        var mouseY = 0;





        preloadAssets();
        // Preload
        function preloadAssets() {
            var _toPreload = 0;

            var addImage = function (src) {

                var img = new Image();
                img.src = src;
                _toPreload++;

                img.addEventListener('load', function () {
                    _toPreload--;
                }, false);
                return img;
            }
            bg = addImage("assets/bg-menu.png");
            bird = addImage("assets/costelloball.png");
            startbutton = addImage("assets/startbutton.png");
            levelbutton = addImage("assets/levelbutton.png");
            creditsbutton = addImage("assets/creditsbutton.png");
            manualbutton = addImage("assets/manualbutton.png");


            var checkResources = function () {
                if (_toPreload == 0)
                    draw(); //6
                else
                    setTimeout(checkResources, 200);
            }
            checkResources();
        }

        // Get Position https://www.kirupa.com/canvas/follow_mouse_cursor.htm
        function getPosition(el) {
            var xPosition = 0;
            var yPosition = 0;

            while (el) {
                xPosition += (el.offsetLeft - el.scrollLeft + el.clientLeft);
                yPosition += (el.offsetTop - el.scrollTop + el.clientTop);
                el = el.offsetParent;
            }
            return {
                x: xPosition,
                y: yPosition
            };
        }


        // Get canvas element and its context
        var canvas = document.getElementById('indexCanvas')
        var ctx = canvas.getContext('2d');

        // Button position and dimensions hard coded, to be resizeable
        var startbuttonX = (glWidth / 2);
        var startbuttonY = 100;
        var startbuttonW = 200;
        var startbuttonH = 90;
        var levelbuttonY = startbuttonY+100;
        var creditsbuttonY = startbuttonY+200;
        var manualbuttonY = startbuttonY+300;
        console.log(glHeight, glWidth);


        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            drawButtons();
            drawbird();
            //setTimeout(draw, 40);
            requestAnimationFrame(draw);
        }

        function drawButtons() {
            ctx.drawImage(startbutton, startbuttonX, startbuttonY, startbuttonW, startbuttonH);
            ctx.drawImage(levelbutton, startbuttonX, levelbuttonY, startbuttonW, startbuttonH);
            ctx.drawImage(creditsbutton, startbuttonX,creditsbuttonY, startbuttonW, startbuttonH);
            ctx.drawImage(manualbutton, startbuttonX, manualbuttonY, startbuttonW, startbuttonH);
        }

        function drawBackground() {
            ctx.drawImage(bg, 0, 0, glWidth, glHeight);
        }

        function drawbird() {
            ctx.drawImage(bird, mouseX-30, mouseY-30, 30, 30);
            //console.log(mouseX, mouseY);
        }



        // Draw

        draw();


        //resize
        function onResize(event) {
            glWidth = window.innerWidth;
            glHeight = window.innerHeight;
            indexCanvas.width = glWidth;
            indexCanvas.height = glHeight;

        }
        // Add event listener to canvas element
        canvas.addEventListener("mousemove", function (event) {
            mouseX = event.clientX - canvasPos.x;
            mouseY = event.clientY - canvasPos.y;
        });
        window.addEventListener('resize', function (event) { onResize(event) }, false);
        canvas.addEventListener('click', function (event) {
                // Control that click event occurred within position of button
                // NOTE: This assumes canvas is positioned at top left corner 

                if (  //Start
                    event.x > startbuttonX &&
                    event.x < startbuttonX + startbuttonW &&
                    event.y > startbuttonY &&
                    event.y < startbuttonY + startbuttonH
                ) {
                    window.open("./gamelogic/game.html", "_self");
                    };
                if ( //Levelselect
                    event.x > startbuttonX &&
                    event.x < startbuttonX + startbuttonW &&
                    event.y > levelbuttonY &&
                    event.y < levelbuttonY + startbuttonH
                ){
                    window.open("./levelselect.html", "_self");
                }; 
                if ( //Manuals
                    event.x > startbuttonX &&
                    event.x < startbuttonX + startbuttonW &&
                    event.y > manualbuttonY &&
                    event.y < manualbuttonY + startbuttonH
                ){
                    window.open("./manual.html", "_self");
                };
                if ( //Credits
                    event.x > startbuttonX &&
                    event.x < startbuttonX + startbuttonW &&
                    event.y > creditsbuttonY &&
                    event.y < creditsbuttonY + startbuttonH
                ){
                    window.open("./credits.html", "_self");
                };   
            });

    </script>
</body>

</html>
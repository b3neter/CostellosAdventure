<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Costellos Adventure Level select</title>

    <style>
        #levelSelectorCanvas{
            margin:0; padding:0; 
            position:absolute; 
            top:0; left:0;
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            border: "red 1px solid";
        }
    </style>
</head>

<body>

    <canvas id="levelSelectorCanvas"></canvas>
    <audio autoplay loop>
        <source src="./assets/audio/music/a05_windbluffs.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script>

        //Basierend auf
        //https://www.quora.com/JavaScript-Can-I-put-a-button-inside-a-canvas
        //Demo aus der Vorlesung
        var levelSelectorCanvas = document.getElementById('levelSelectorCanvas');
        var ctx = levelSelectorCanvas.getContext("2d");
        var bg;
        var bird;
        var returnbutton;
        var level;
        var glWidth = window.innerWidth;
        var glHeight = window.innerHeight;
        levelSelectorCanvas.width = glWidth;
        levelSelectorCanvas.height = glHeight;
        var canvasPos = getPosition(canvas);
        var mouseX = 0;
        var mouseY = 0;





        preloadAssets();
        // Preload
        function preloadAssets() {
            var _toPreload = 0;

            var addImage = function (src) {

                var img = new Image();
                img.src = src;
                _toPreload++;

                img.addEventListener('load', function () {
                    _toPreload--;
                }, false);
                return img;
            }
            bg = addImage("assets/bg-menu.png");
            bird = addImage("assets/costelloball.png");
            returnbutton = addImage("assets/mainmenubutton.png");

            var checkResources = function () {
                if (_toPreload == 0)
                    draw(); //6
                else
                    setTimeout(checkResources, 200);
            }
            checkResources();
        }

        // Get Position https://www.kirupa.com/canvas/follow_mouse_cursor.htm
        function getPosition(el) {
            var xPosition = 0;
            var yPosition = 0;

            while (el) {
                xPosition += (el.offsetLeft - el.scrollLeft + el.clientLeft);
                yPosition += (el.offsetTop - el.scrollTop + el.clientTop);
                el = el.offsetParent;
            }
            return {
                x: xPosition,
                y: yPosition
            };
        }


        // Get canvas element and its context
        var canvas = document.getElementById('levelSelectorCanvas')
        var ctx = canvas.getContext('2d');

        // Button position and dimensions hard coded, to be resizeable
        var returnbuttonX = (glWidth / 2);
        var returnbuttonY = 100;
        var returnbuttonW = 200;
        var returnbuttonH = 90;

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            drawButtons();
            drawbird();
            requestAnimationFrame(draw);
        }

        function drawButtons() {
            ctx.drawImage(returnbutton, returnbuttonX, returnbuttonY, returnbuttonW, returnbuttonH);
        }

        function drawBackground() {
            ctx.drawImage(bg, 0, 0, glWidth, glHeight);
        }

        function drawbird() {
            ctx.drawImage(bird, mouseX-30, mouseY-30, 30, 30);
        }



        // Draw

        draw();


        //resize
        function onResize(event) {
            glWidth = window.innerWidth;
            glHeight = window.innerHeight;
            levelSelectorCanvas.width = glWidth;
            levelSelectorCanvas.height = glHeight;

        }
        // Add event listener to canvas element
        canvas.addEventListener("mousemove", function (event) {
            mouseX = event.clientX - canvasPos.x;
            mouseY = event.clientY - canvasPos.y;
        });
        window.addEventListener('resize', function (event) { onResize(event) }, false);
        canvas.addEventListener('click', function (event) {
                // Control that click event occurred within position of button
                // NOTE: This assumes canvas is positioned at top left corner 

                if (  //Return
                    event.x > returnbuttonX &&
                    event.x < returnbuttonX + returnbuttonW &&
                    event.y > returnbuttonY &&
                    event.y < returnbuttonY + returnbuttonH
                ) {
                    window.open("./index.html", "_self");
                    };
                if ( //Levelselect
                    event.x > startbuttonX &&
                    event.x < startbuttonX + startbuttonW &&
                    event.y > levelbuttonY &&
                    event.y < levelbuttonY + startbuttonH
                ){
                    window.open("./levelselect.html", "_self");
                }; 
                
            });

    </script>
</body>

</html>